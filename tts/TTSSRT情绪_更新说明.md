# TTSSRT情绪.pyw 更新说明

## 更新日期
2025-10-10

## 新增功能

### 1. edge-tts SSML情绪标签支持补丁
- 自动应用补丁，使edge-tts支持SSML情绪标签
- 支持`<mstts:express-as>`标签，用于情绪控制
- 自动处理文本转义和标签保留

### 2. 基础语音参数控制
在设置面板中新增：
- **语速控制**: -50% 至 +50%（默认 +0%）
- **音调控制**: -50Hz 至 +50Hz（默认 +0Hz）
- **音量控制**: -50% 至 +50%（默认 +0%）

### 3. 情绪控制功能（SSML）
完整的情绪表达系统，包括：

#### 情绪样式（40+种）
- **常用情绪**: 普通、高兴、悲伤、生气、兴奋、友好、温柔、冷静、严肃
- **进阶情绪**: 恐惧、惊恐、不满、沮丧、尴尬、嫉妒、充满希望、亲切、抒情
- **语气变化**: 低语、喊叫、不友好
- **专业场景**: 助手、聊天、客服、新闻播报、体育播报、纪录片、广告
- **专业朗读**: 诗歌朗读、讲故事、轻松叙述
- **其他**: 同情、鼓励、肯定

#### 情绪强度
- 范围: 0.01 - 2.00
- 默认值: 1.00
- 通过滑动条精确控制

#### 角色扮演
支持不同年龄段和性别的角色：
- 女孩、男孩
- 年轻女性、年轻男性
- 成熟女性、成熟男性
- 老年女性、老年男性

### 4. UI改进
- 折叠式设置面板，布局更清晰
- 情绪控制区域带emoji图标，更直观
- 添加情绪功能说明提示
- 启用/禁用开关，便于快速切换

### 5. 设置持久化
所有新增参数都会自动保存到`tts_settings.json`，包括：
- 语速、音调、音量设置
- 情绪控制开关状态
- 选中的情绪样式
- 情绪强度值
- 角色扮演选择

## 使用说明

### 基础参数调整
1. 在"基础参数"区域选择语速、音调、音量
2. 参数会应用到所有选中的语音模型

### 启用情绪控制
1. 勾选"启用情绪控制 (SSML)"
2. 选择想要的情绪样式（如"😊 高兴"）
3. 调整情绪强度滑动条（建议范围0.8-1.5）
4. 可选：选择角色扮演（如"👧 女孩"）

### 注意事项
⚠️ **重要**：
- 不同语音支持的情绪不同，部分情绪可能无效果
- 推荐使用中文语音（如晓晓/云希/云扬）测试情绪功能
- 英文语音支持的情绪样式可能与中文不同
- 情绪强度过高（>1.5）可能导致不自然的效果

## 技术细节

### SSML标签格式
```xml
<mstts:express-as style="cheerful" styledegree="1.2" role="Girl">
  你好，这是带情绪的语音！
</mstts:express-as>
```

### TTSWorker参数扩展
新增参数：
- `rate`: 语速
- `pitch`: 音调
- `volume`: 音量
- `enable_emotion`: 是否启用情绪
- `style`: 情绪样式
- `styledegree`: 情绪强度
- `role`: 角色扮演

### 补丁机制
通过猴子补丁（Monkey Patch）修改edge-tts的核心函数：
1. `mkssml`: 添加mstts命名空间
2. `Communicate.__init__`: 提取SSML标签
3. `split_text_by_byte_length`: 还原SSML标签

## 兼容性
- 完全兼容原有功能
- 不影响未启用情绪控制的使用
- 向后兼容旧版设置文件

## 参考
基于 `clipboard_tts\clipboard_tts情绪.pyw` 的实现

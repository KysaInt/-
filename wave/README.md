# 音频处理工具集

## 功能介绍
这是一个基于Python的音频处理工具集，包含音频切分和音频转MIDI两大功能，具有简洁的图形界面。

### 1. 音频切分工具 (切分.py)
- **音频自动切分**：基于静音检测自动切分音频文件
- **淡入淡出效果**：可开关的淡入淡出效果，增强音频片段的听感
- **灵活参数设置**：可调节静音阈值、最小静音长度、过渡时长等参数
- **多格式支持**：支持 MP3、WAV、FLAC、AAC、OGG、M4A 等常见音频格式
- **实时进度显示**：显示处理进度和详细日志信息

### 2. 音频转MIDI工具 (to midi.py)
- **批量转换**：可以处理指定目录下的所有音频文件
- **单音轨输出**：生成单音轨MIDI文件，适合钢琴演奏
- **智能音高检测**：使用先进的CQT算法检测音频中的音高
- **参数可调**：可调节跳跃长度、帧阈值、频率阈值等参数
- **实时监控**：显示转换进度和详细处理日志

## 安装步骤

### 1. 安装Python依赖
首先运行依赖安装脚本：
```bash
python install_dependencies.py
```
这将安装以下依赖库：
- `pydub`：音频处理
- `numpy`：数值计算
- `librosa`：音频分析（MIDI转换需要）
- `mido`：MIDI文件处理

### 2. 安装FFmpeg（可选，处理MP3等格式需要）
- 从 https://ffmpeg.org/download.html 下载FFmpeg
- 将FFmpeg添加到系统PATH环境变量中
- 或者将ffmpeg.exe放在程序同一目录下

## 使用方法

### 音频切分工具

#### 1. 启动程序
```bash
python 切分.py
```

#### 2. 界面设置

#### 文件选择
- **输入音频文件**：选择要切分的音频文件
- **输出目录**：选择切分后文件的保存位置

#### 切分设置
- **静音阈值 (dB)**：范围 -60 到 -10，默认 -40
  - 数值越小，检测静音越严格
  - 建议：语音文件 -40dB，音乐文件 -50dB
  
- **最小静音长度 (ms)**：范围 100 到 2000，默认 500
  - 静音持续多长时间才被认为是分割点
  - 建议：快节奏内容 300ms，慢节奏内容 800ms
  
- **保留静音长度 (ms)**：范围 0 到 500，默认 100
  - 在切分点前后保留多长的静音
  - 避免切分太突兀
  
- **最小片段长度 (s)**：范围 0.5 到 10.0，默认 1.0
  - 过短的片段会被过滤掉
  - 避免产生太多碎片文件

#### 淡入淡出设置
- **启用淡入**：为每个片段添加淡入效果
- **启用淡出**：为每个片段添加淡出效果
- **过渡时长 (s)**：范围 0.01 到 1.0，默认 0.1
  - 淡入淡出的持续时间
  - 建议：音乐 0.2s，语音 0.05s

### 3. 开始切分
点击"开始切分"按钮，程序会：
1. 加载音频文件
2. 分析静音片段
3. 切分音频
4. 应用淡入淡出效果
5. 保存到指定目录

### 音频转MIDI工具

#### 1. 启动程序
```bash
python "to midi.py"
```
或者运行快捷启动脚本：
```bash
python 启动MIDI转换.py
```

#### 2. 界面设置

##### 目录选择
- **音频文件目录**：选择包含音频文件的目录（支持子目录扫描）
- **MIDI输出目录**：选择转换后MIDI文件的保存位置

##### 转换参数
- **跳跃长度 (Hop Length)**：范围 256 到 2048，默认 512
  - 控制分析精度，数值越小精度越高但处理越慢
  - 建议：快速转换 1024，精确转换 256
  
- **帧阈值**：范围 0.1 到 1.0，默认 0.3
  - 控制音符检测的敏感度
  - 数值越小检测到的音符越多
  
- **频率阈值**：范围 0.1 到 1.0，默认 0.5
  - 控制频率峰值检测的严格程度
  - 建议：简单音频 0.3，复杂音频 0.7

#### 3. 开始转换
点击"开始转换"按钮，程序会：
1. 扫描目录中的音频文件
2. 逐个加载音频文件
3. 分析音频频谱
4. 检测音高并生成MIDI音符
5. 保存为MIDI文件

## 输出文件

### 音频切分工具
切分后的文件会以 WAV 格式保存，命名规则：
```
原文件名_part_001.wav
原文件名_part_002.wav
...
```

### 音频转MIDI工具
转换后的文件会以 MIDI 格式保存，命名规则：
```
原文件名.mid
```
- 单音轨钢琴MIDI文件
- 标准MIDI格式，兼容各种音乐软件
- 支持音域：A0-C8 (MIDI音符21-108)

## 常见问题

### 音频切分工具

#### Q: 为什么切分出来的片段太多？
A: 尝试调整以下参数：
- 提高静音阈值（比如从-40改为-35）
- 增加最小静音长度
- 增加最小片段长度

#### Q: 为什么没有检测到任何片段？
A: 尝试调整以下参数：
- 降低静音阈值（比如从-40改为-45）
- 减少最小静音长度
- 检查音频文件是否正常

### 音频转MIDI工具

#### Q: 生成的MIDI文件音符太多或太少？
A: 尝试调整以下参数：
- 音符太多：提高帧阈值和频率阈值
- 音符太少：降低帧阈值和频率阈值
- 调节跳跃长度来平衡精度和性能

#### Q: 转换速度很慢怎么办？
A: 可以尝试：
- 增加跳跃长度(Hop Length)到1024或2048
- 处理前先将音频文件转换为WAV格式
- 确保音频文件不要太长（建议小于5分钟）

#### Q: 生成的MIDI音高不准确？
A: 这可能是由于：
- 音频质量较低或包含噪音
- 音频中包含多个乐器或人声
- 建议使用单乐器演奏的清晰录音

### 通用问题

#### Q: 支持哪些音频格式？
A: 输入支持 MP3、WAV、FLAC、AAC、OGG、M4A 等，音频切分输出为 WAV 格式，MIDI转换输出为 MID 格式

#### Q: 如何处理MP3文件？
A: 需要安装FFmpeg，参考安装步骤中的说明

## 技术说明
### 音频切分工具
- 使用 `pydub` 库进行音频处理
- 使用 `tkinter` 创建图形界面
- 基于音频波形的能量检测进行静音识别
- 支持多线程处理，界面不会卡顿

### 音频转MIDI工具
- 使用 `librosa` 库进行音频分析
- 使用 `mido` 库生成MIDI文件
- 采用CQT (Constant-Q Transform) 算法进行音高检测
- 支持钢琴音域 (A0-C8) 的音符生成
- 多线程处理确保界面响应

## 版本历史
- v1.0：基本的音频切分功能
- v1.1：添加图形界面操作和淡入淡出效果
- v2.0：新增音频转MIDI功能
  - 支持批量目录处理
  - 智能音高检测
  - 单音轨MIDI输出
  - 可调参数优化

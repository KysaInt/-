# 音频可视化工具 - 设计说明

## 项目概述

音频可视化工具，采用主控界面+动画窗口分离的架构设计，支持三种可视化效果：频谱条、圆形频谱、波形图。

## 架构设计

### 整体架构
```
主控界面 (audio_visualizer_qt.py)
    ↓ 进程间通信
动画窗口 (visualizer_window.py)
    ↓ 音频捕获
Windows WASAPI Loopback
```

### 文件说明

**主程序:**
- `audio_visualizer_qt.py` - Qt 主控界面，提供参数控制和可视化启动

**子程序（可独立运行）:**
- `1.py` - 频谱条可视化（独立版）
- `2.py` - 圆形频谱可视化（独立版）
- `3.py` - 波形图可视化（独立版）

**支持模块:**
- `visualizer_window.py` - 动画窗口实现（主程序调用）
- `requirements_audio_viz.txt` - Python 依赖列表

## UI 设计规范

严格遵循 `UI_DESIGN_GUIDE.md` 设计指南：

### 主控界面布局
```
┌─────────────────────────────────────┐
│  [导航]  │  [内容区]                │
│  100px   │                          │
│          │  ╔═══════════════════╗  │
│ 主控制   │  ║ 通用参数设置      ║  │
│ 频谱条   │  ║                   ║  │
│ 圆形谱   │  ║                   ║  │
│ 波形图   │  ║                   ║  │
│ 关于     │  ╚═══════════════════╝  │
└─────────────────────────────────────┘
```

- **左侧**: QListWidget 导航栏（固定 100px）
- **右侧**: QStackedWidget 内容区
- **字体**: 微软雅黑 9pt
- **布局**: QGridLayout 表单布局
- **控件**: 标准 Qt 组件（QSpinBox, QSlider, QComboBox 等）

### 动画窗口特性

**智能锁定按钮:**
1. 右上角悬停区域（80×80px）触发显示
2. 显示锁定/解锁图标（🔒/🔓）
3. 解锁后可拖动窗口
4. 鼠标离开 1 秒后自动隐藏

**窗口属性:**
- 无边框透明窗口
- 始终置顶
- 背景透明（黑色为透明键）
- 60 FPS 刷新率

## 技术实现

### 多进程架构
- 主界面和动画窗口运行在独立进程
- 使用 `multiprocessing.Queue` 传递配置
- 避免 UI 卡顿，确保动画流畅

### 音频处理
```
系统音频 → WASAPI Loopback → PyAudio 捕获
    ↓
FFT 频谱分析 (scipy)
    ↓
对数刻度分组
    ↓
平滑处理
    ↓
Pygame 渲染
```

### 可视化算法

**频谱条 (1.py):**
- FFT 频谱分析
- 对数刻度 64 条
- 渐变发光效果
- 平滑因子 0.7

**圆形频谱 (2.py):**
- 圆形放射布局
- 360° 均匀分布
- 半径 150px
- 线条宽度 3px

**波形图 (3.py):**
- 实时波形绘制
- 降采样适配屏幕宽度
- 中线对称显示
- 线条宽度 2px

## 使用方式

### 主程序使用
```bash
python audio_visualizer_qt.py
```
1. 主界面打开
2. 选择可视化模式
3. 调整参数
4. 点击"启动可视化"
5. 动画窗口自动弹出

### 子程序独立使用
```bash
python 1.py  # 频谱条
python 2.py  # 圆形频谱
python 3.py  # 波形图
```
- 直接启动，无需主界面
- 鼠标拖动移动窗口
- 按 Q 或 ESC 退出

## 依赖要求

```
PySide6 >= 6.0.0  # Qt 界面框架
pygame            # 动画渲染
pyaudiowpatch     # Windows 音频捕获
numpy             # 数值计算
scipy             # FFT 分析
```

## 设计亮点

1. **主界面与动画分离**: 便于独立调试和使用
2. **智能锁定机制**: 防止误触，提升用户体验
3. **实时参数调整**: 配置即时生效，无需重启
4. **透明悬浮效果**: 不遮挡桌面，美观实用
5. **独立子程序**: 可单独运行，灵活方便

## 版本信息

- **版本**: v2.0
- **日期**: 2026-02-12
- **作者**: AYE
- **框架**: PySide6 + Pygame

---

参考文档: `UI_DESIGN_GUIDE.md`
